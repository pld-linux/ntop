--- ntop-3.3.10.org/configure.in	2009-08-05 19:30:31.141160363 +0530
+++ ntop-3.3.10/configure.in	2009-08-05 19:34:11.076160092 +0530
@@ -1962,40 +1962,23 @@
     }'`
 fi
 
-dnl> GeoIP (http://www.maxmind.com/)
-if test -f "GeoIP.tar.gz"; then
-   echo "GeoIP already present on this machine"
-else
-   wget http://www.maxmind.com/download/geoip/api/c/GeoIP.tar.gz
-fi
-tar xvfz GeoIP.tar.gz
-GEO_DIR=`find $PWD -type d -name "GeoIP-*"`
-cd $GEO_DIR; ./configure --prefix=${prefix}; make; cd ..
-# OSX Fix
-GEO_DYLIB="$GEO_DIR/libGeoIP/.libs/libGeoIP.dylib"
-if test -f $GEO_DYLIB; then
-   ln -s $GEO_DYLIB .
-fi
-
-if test -f "GeoLiteCity.dat"; then
-   echo "GeoLiteCity.dat already present"
-else
-   wget http://www.maxmind.com/download/geoip/database/GeoLiteCity.dat.gz
-   gunzip GeoLiteCity.dat.gz
-fi
-
-if test -f "GeoIPASNum.dat"; then
-   echo "GeoIPASNum.dat already present"
-else
-   wget http://www.maxmind.com/download/geoip/database/asnum/GeoIPASNum.dat.gz
-   gunzip GeoIPASNum.dat.gz
+#
+#GeoIP
+#
+AC_CHECK_HEADERS(
+    [GeoIP.h],
+    [geoip_header="yes"],
+    [AC_MSG_FAILURE([GeoIP header file is missing])]
+)
+if test "$geoip_header" = "yes"; then
+    AC_CHECK_LIB(GeoIP, GeoIP_open,
+        [geoip_libs="yes"],
+	[AC_MSG_FAILURE([GeoIP library is missing])]
+    )
+fi
+if test "$geoip_libs" = "yes"; then
+    LDFLAGS="${LDFLAGS} -lGeoIP"
 fi
-
-
-GEO_DIR=`find $PWD -type d -name "GeoIP-*"`
-GEO_IP="$GEO_DIR/libGeoIP/"
-CFLAGS="$CFLAGS -I$GEO_IP"
-LDFLAGS="-L$GEO_IP.libs/ -lGeoIP $LDFLAGS"
 
 dnl> NTOPCONFIGDEBUG_SETTINGS([precet])
 
--- ntop-3.3.10/Makefile.am	2009-08-05 19:34:51.918165468 +0530
+++ ntop-3.3.10/Makefile.am	2010-04-07 00:12:39.762063904 +0300
@@ -73,12 +73,15 @@
 ETTER_PASSIVE_DOWNLOAD_FROM = "http://ettercap.cvs.sourceforge.net/ettercap/ettercap_ng/share"
 ETTER_PASSIVE_DOWNLOAD_PARMS = "rev=HEAD"
 
+GEOIP_FILES = \
+	GeoIPASNum.dat \
+	GeoLiteCity.dat
+
 NTOPDATA = ntop-cert.pem \
            $(ETTER_PASSIVE) \
            oui.txt.gz \
            specialMAC.txt.gz \
-	   GeoIPASNum.dat \
-	   GeoLiteCity.dat
+		   $(GEOIP_FILES)
 
 NTOPHTML = html html/*.js html/*.html  html/*.gif html/*.jpg html/*.ico html/*.png \
            html/*.css html/*.dtd \
@@ -270,8 +273,6 @@
 
 install: install-recursive
 
-	cd @GEO_DIR@; make install
-
 	@mkdir -p $(DESTDIR)/$(CFG_DBFILE_DIR)
 
 	@echo ""
